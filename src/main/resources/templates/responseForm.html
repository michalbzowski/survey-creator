<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Odpowiedź na zapytanie</title>
    <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
</head>
<body>
<h2>Witaj, {link.person.firstName} {link.person.lastName} </h2>
<p>({link.person.email})</p>
<p><strong>{link.survey.name}</strong></p>
<form action="/web/responses/{link.linkToken}" id="response-form">
    {#each link.survey.events}
    <article>
        <p><strong>{it.name}</strong></p>
        <p>{it.location}</p>
        <p>{it.localDateTime}</p>
        <p>{it.description}</p>
        <label for="{it.id}">Odpowiedź:</label>
        <select class="answer-entry" name="{it.id}" id="{it.id}" required>
            <option value="">-- wybierz --</option>
            <option value="TAK">Tak</option>
            <option value="NIE">Nie</option>
            <option value="ODPOWIEM_POZNIEJ">Odpowiem później</option>
        </select>
    </article>
    {/each}
    <button type="submit">Wyślij</button>
</form>
</body>
<script>
    document.getElementById('response-form').addEventListener('submit', async function(event) {
    event.preventDefault();

    // Zbierz dane podstawowe
    const form = event.target;
    const formData = new FormData(form);

    // Przygotuj obiekt z odpowiedziami na pytania
    const answers = {};
    formData.forEach((value, key) => {
        // key będzie ID pytania, value to wybrana odpowiedź
        answers[key] = value;
    });

    // Wyślij JSON zawierający token i odpowiedzi (jeśli token chcesz wysłać)
    const linkToken = form.action.split('/').pop(); // wyciąganie tokenu z URL

    const payload = answers;

    try {
        const response = await fetch(form.action, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        });

        if (response.ok) {
            window.location.href = '/web/thank_you';
        } else {
            alert('Błąd podczas wysyłania odpowiedzi');
        }
    } catch (error) {
        console.error('Błąd sieci:', error);
        alert('Błąd połączenia');
    }
});

</script>
</html>
